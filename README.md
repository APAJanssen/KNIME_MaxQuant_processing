# KNIME MaxQuant processing
Automated workflows for the processing of MaxQuant proteomics output

**Overview** 

<p align="justify">The data analysis workflow was built in KNIME Analytics Platform 4.5.2 with two additional modules: KNIME Python Integration and the Vernalis KNIME nodes. The workflow is fully annotated to provide insight in the data analysis steps. A sample list template has been created in Microsoft Excel that provides a convenient user input for the automated workflow (sample list.xlsx). The sample list template is used to cross-correlate .raw file names and treatment conditions, as well as define proteins of interest (POI). This sample list, together with the MaxQuant output (proteinGroups.txt), is read in by KNIME. Here, in brief, the MaxQuant output is sanitised by removal of reverse peptides and contaminants, and grouped identifications are split towards their first (predominant) identification. Proteins with fewer than 2 unique peptides (configurable) are removed. A Gaussian distribution is fitted through all log2 transformed LFQ values using Pythons SciPy norm.fit. This distribution is then transformed by shifting µ left 1.8σ and reducing σ by 70% as per default settings of Perseus developed by Jürgen Cox and colleagues. This resulting normal distribution is used to impute missing values for enriched proteins. Enrichment of proteins in probe-treated positive controls vs. DMSO treated negative controls is calculated based on raw Intensity values, and all proteins with a ratio ≥ 2 are considered probe targets. Further quality filtering is performed by ensuring that the positive controls have at most 1 missing LFQ intensity value. For the resulting enriched proteins missing values are imputed, and LFQ intensities are normalised with respect to mean unimputed positive control values. Proteins where the highest concentration of inhibitor shows ≤ 60 % probe labeling are flagged for pEC50 fitting. The EC50 and Hill slope are fitted using Pythons SciPy optimize.curve_fit algorithm using the equation:

$$ x = {100 \over 1+e^{Hill*(\log{}[inhibitor]-\log{}[EC_{50}])}} $$

<p align="justify">where Hill is the Hill-slope, [inhibitor] is the concentration of inhibitor used. Initial values for Hill slope and EC50 are provided as 1 and 1000, respectively. The Hill slope is bounded to be fit between 0 and 5. Fits are classified as ‘Good’ if 0.3 ≤ Hill slope ≤ 3.0, σ(pEC50) ≤ 1.0 and pEC50 ≥ Max(p[inhibitor]) 0.5, and as ‘Poor’ otherwise. LFQ intensity histogram plots are generated highlighting each protein to visualise the relative abundance. MS/MS counts and Unique peptide counts, averaged per replicate, are plotted per concentration of inhibitor to show available MS evidence for each plotted intensity. Finally, a phylogenetic tree is generated based on the seminal paper of Manning et al.48 and data visualization tools developed in the Phanstiel lab.32 All plots are exported as scaled vector graphic files, and together with the curve fits written to a Microsoft Excel file. 

## Installation
<p align="justify">KNIME can be downloaded free of charge from KNIME.com. We advise to set up a conda python environment to use with KNIME, instructions for which can be found here:
  
https://docs.knime.com/2019-06/python_installation_guide/index.html#setup_python_integration
<p align="justify">When installed, the workflow downloaded from this repository can be imported through File->Import workflow. The software will warn that there are missing dependencies (KNIME Python Integration (if not yet installed) and the Vernalis KNIME nodes) and propose to search and install these. Approve, and after a restart of KNIME the workflow should load. 

## Basic usage
<p align="justify">By double clicking the sole gray component, a GUI is presented to configure the settings of the analysis. Main settings to change are the location of the sample list.xlsx file and the location of the proteinGroups.txt file. The output files will be created in the same folder as the sample list, so place this in a sensible destination (preferably a dedicated folder). After configuration, close the settings menu by clicking OK, and execute the node by pressing the F7 key or the green 'Play' icon in the top bar. After a few minutes, the node should finish, and the output port will show the processed data. More importantly, in the folder where the sample list was presented, the output .xlsx file will be created, containing all numerical and graphical output generated by the workflow. 
